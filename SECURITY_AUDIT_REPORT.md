# üîí –û—Ç—á—ë—Ç –ø–æ –∞—É–¥–∏—Ç—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞:** 30 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ù–∞–π–¥–µ–Ω–æ | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
|-----------|---------|------------|
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ | 2 | 2 |
| –í—ã—Å–æ–∫–∏–µ | 3 | 3 |
| –°—Ä–µ–¥–Ω–∏–µ | 2 | 2 |
| –ù–∏–∑–∫–∏–µ | 2 | 1 |

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–´)

### 1. Path Traversal –≤ `/api/profile/avatar/[...path]`

**–§–∞–π–ª:** `src/app/api/profile/avatar/[...path]/route.ts`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—É—Ç–∏ –ø–æ–∑–≤–æ–ª—è–ª–æ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫—É —á–∏—Ç–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ URL –≤–∏–¥–∞:
```
/api/profile/avatar/../../../etc/passwd
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `..`, `.` –∏ –ø—É—Å—Ç—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏—Ç–æ–≥–æ–≤—ã–π –ø—É—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

---

### 2. –£—è–∑–≤–∏–º–æ—Å—Ç—å Next.js 16.0.8

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Ä—Å–∏—è Next.js –∏–º–µ–ª–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:
- [GHSA-w37m-7fhw-fmv9](https://github.com/advisories/GHSA-w37m-7fhw-fmv9) - Source Code Exposure
- [GHSA-mwv6-3258-q52c](https://github.com/advisories/GHSA-mwv6-3258-q52c) - DoS —Å Server Components

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω Next.js —Å `16.0.8` –¥–æ `16.1.1`

---

## ‚ö†Ô∏è –í—ã—Å–æ–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–´)

### 3. –†–∞—Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ `/api/auth/check-config`

**–§–∞–π–ª:** `src/app/api/auth/check-config/route.ts`

**–û–ø–∏—Å–∞–Ω–∏–µ:** Endpoint —Ä–∞—Å–∫—Ä—ã–≤–∞–ª –¥–ª–∏–Ω—ã —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π, —á—Ç–æ –º–æ–≥–ª–æ –ø–æ–º–æ—á—å –∞—Ç–∞–∫—É—é—â–µ–º—É.

**–ë—ã–ª–æ:**
```json
{
  "nextAuthSecretLength": 32,
  "googleClientIdLength": 72
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –£–±—Ä–∞–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–ª–∏–Ω–∞—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (true/false)

---

### 4. Fallback secret –≤ NextAuth

**–§–∞–π–ª:** `src/lib/auth.ts`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–æ–¥ —Å–æ–¥–µ—Ä–∂–∞–ª fallback secret, –∫–æ—Ç–æ—Ä—ã–π –º–æ–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ production.

**–ë—ã–ª–æ:**
```typescript
secret: nextAuthSecret || "fallback-secret-change-in-production"
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ Fallback –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è development/build
- ‚úÖ –í—ã–≤–æ–¥–∏—Ç—Å—è —è–≤–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∏ –µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –í production –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–§–∞–π–ª:** `src/app/api/documents/route.ts`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ú–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –ª—é–±–æ–≥–æ —Ç–∏–ø–∞, –≤–∫–ª—é—á–∞—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ whitelist —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ MIME-—Ç–∏–ø–æ–≤
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–∏–ø—ã: PDF, DOC, XLS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∞—Ä—Ö–∏–≤—ã

---

## üìã –°—Ä–µ–¥–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–´)

### 6. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `src/app/api/auth/register/route.ts`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω cost factor —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è bcrypt (10 ‚Üí 12)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª—è

---

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Security Headers

**–§–∞–π–ª:** `next.config.ts`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `X-Content-Type-Options: nosniff`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `X-Frame-Options: DENY`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `X-XSS-Protection: 1; mode=block`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `Referrer-Policy: strict-origin-when-cross-origin`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `Permissions-Policy`

---

## ‚ÑπÔ∏è –ù–∏–∑–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 8. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Rate Limiting ‚ö†Ô∏è –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–û

**–û–ø–∏—Å–∞–Ω–∏–µ:** API endpoints –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ:
- Nginx Proxy Manager (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å middleware —Å `@upstash/ratelimit`

**–ü—Ä–∏–º–µ—Ä –¥–ª—è nginx:**
```nginx
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;

location /api/ {
    limit_req zone=api burst=20 nodelay;
    proxy_pass http://main-app:3000;
}
```

---

### 9. –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –≤–µ—Ä—Å–∏—è Prisma

**–û–ø–∏—Å–∞–Ω–∏–µ:** Prisma 5.22.0 –¥–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ 7.2.0

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –≠—Ç–æ major update, —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:
```bash
npm i --save-dev prisma@latest
npm i @prisma/client@latest
```

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ API routes** - –≤—Å–µ protected endpoints –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–µ—Å—Å–∏—é
2. **–í–ª–∞–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏** - –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∑–∞–∫–∞–∑—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç userId
3. **CSRF –∑–∞—â–∏—Ç–∞** - NextAuth –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É
4. **JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
5. **Prisma ORM** - –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
6. **–ü–∞—Ä–æ–ª–∏** - —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å bcrypt
7. **Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –∑–∞–ø—É—Å–∫ –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
8. **Healthchecks** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `package.json` | Next.js 16.0.8 ‚Üí 16.1.1 |
| `next.config.ts` | –î–æ–±–∞–≤–ª–µ–Ω—ã Security Headers |
| `src/app/api/profile/avatar/[...path]/route.ts` | –ó–∞—â–∏—Ç–∞ –æ—Ç Path Traversal |
| `src/app/api/auth/check-config/route.ts` | –£–±—Ä–∞–Ω–æ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ |
| `src/app/api/auth/register/route.ts` | –í–∞–ª–∏–¥–∞—Ü–∏—è email, —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è |
| `src/app/api/documents/route.ts` | –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ |
| `src/lib/auth.ts` | –£–±—Ä–∞–Ω fallback secret |

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ `docker-compose.yml`:**
   - –ó–∞–º–µ–Ω–∏—Ç–µ –≤—Å–µ `xxxxxxx` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - `NEXTAUTH_SECRET` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: `openssl rand -base64 32`

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å PostgreSQL –Ω–∞ —Å–ª–æ–∂–Ω—ã–π
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ë–î —Ç–æ–ª—å–∫–æ –∏–∑ Docker —Å–µ—Ç–∏

3. **SSL/TLS:**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS —á–µ—Ä–µ–∑ nginx-proxy-manager
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

4. **Rate Limiting:**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ nginx-proxy-manager
   - –û—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è `/api/auth/*` –∏ `/api/ai/chat`

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π

6. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ backup PostgreSQL
   - Backup volumes –¥–ª—è uploads

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ npm audit
npm audit

# –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript
npx tsc --noEmit

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run build

# ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!
# npm audit: found 0 vulnerabilities
# TypeScript: No errors
# Build: Completed successfully
```

---

**–ê—É–¥–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω:** Claude (Anthropic)  
**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
